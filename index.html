<!doctype html>
<html lang="zh-Hant">

<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4f46e5">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>5×3 RPG 主題拉霸機（HTML+JS 原型）</title>
  <!-- 暫留最小必要樣式；之後可獨立出 styles.css -->
  <style>
    :root {
      --cell: 88px;
      --gap: 12px;
      --radius: 16px;
    }

    body {
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial;
      background: #f6f7fb;
      color: #0f172a;
      margin: 0;
    }

    .wrap {
      max-width: 980px;
      margin: 32px auto;
      padding: 0 16px;
    }

    h1 {
      font-size: 24px;
      margin: 0 0 8px;
    }

    .muted {
      color: #64748b;
      font-size: 13px;
    }

    .topbar {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 16px;
      margin: 16px 0;
    }

    .card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .04);
      padding: 12px 16px;
    }
        /* 規則對話框相關樣式 */
    .rules-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.5); /* 約 50% 不透明度 */
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
      z-index: 50;
    }

    .rules-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .rules-dialog {
      background: #0f172a;
      border-radius: 16px;
      padding: 20px 20px 48px;
      max-width: 520px;
      width: calc(100% - 32px);
      box-shadow: 0 24px 80px rgba(0, 0, 0, .7);
      position: relative;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb; /* 確保文字是亮色 */
    }

    .rules-dialog h2 {
      margin: 0 0 8px;
      font-size: 20px;
    }

    .rules-dialog p {
      margin: 4px 0;
      font-size: 14px;
      line-height: 1.6;
    }

    .rules-dialog ul {
      margin: 6px 0 0 18px;
      padding: 0;
      font-size: 14px;
      line-height: 1.6;
    }

    .rules-dialog li {
      margin-bottom: 4px;
    }

    .rules-close-btn {
      position: absolute;
      right: 16px;
      bottom: 12px;
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid #64748b;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 12px;
      cursor: pointer;
    }

    .btn {
      padding: 12px 20px;
      border-radius: 14px;
      border: 0;
      background: #4f46e5;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(79, 70, 229, .25);
    }

    .btn[disabled] {
      opacity: .55;
      cursor: not-allowed;
    }

    .slot {
      position: relative;
      background: linear-gradient(#e2e8f0, #eef2f7);
      border: 1px solid #e2e8f0;
      border-radius: 24px;
      padding: 12px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: var(--gap);
    }

    .col {
      display: grid;
      grid-template-rows: repeat(3, 1fr);
      gap: var(--gap);
    }

    .cell {
      width: var(--cell);
      height: var(--cell);
      display: grid;
      place-items: center;
      font-size: 34px;
      font-weight: 800;
      border-radius: var(--radius);
      border: 1px solid #e5e7eb;
      background: #fff;
      box-shadow: inset 0 -2px 0 rgba(0, 0, 0, .04);
      transition: transform .12s ease;
    }

    .cell.win {
      outline: 4px solid #10b981;
      box-shadow: 0 0 0 2px #bbf7d0, inset 0 -2px 0 rgba(0, 0, 0, .04);
      transform: translateY(-2px);
    }

    .chip {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
    }

    .chip-blue {
      background: #dbeafe;
      color: #1e40af;
    }

    .chip-red {
      background: #fee2e2;
      color: #991b1b;
    }

    .chip-green {
      background: #dcfce7;
      color: #14532d;
    }

    .chip-yellow {
      background: #fef9c3;
      color: #854d0e;
    }

    .chip-purple {
      background: #f3e8ff;
      color: #6b21a8;
    }

    .chip-indigo {
      background: #e0e7ff;
      color: #3730a3;
    }

    .chip-amber {
      background: #fde68a;
      color: #78350f;
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>5×3 RPG 主題拉霸機（HTML+JS 原型）</h1>
    <div class="muted">含 Wild（★ Arcane）與 Scatter（✦ Deity）；10 條固定線；左至右判定。</div>
    <button id="rulesBtn" class="btn" style="padding:4px 10px; font-size:12px;">規則</button>
    <div class="topbar">
      <div class="card">
        <div class="muted">上次總擊中（攻擊力）</div>
        <div id="lastWin" style="font-size:28px; font-weight:800;">0</div>
      </div>
      <div style="text-align:center; display:flex; flex-direction:column; gap:8px; align-items:center;">
        <button id="spinBtn" class="btn">SPIN 旋轉</button>
        <button id="freeSpinBtn" class="btn" disabled>FREE SPIN (0)</button>
      </div>
      <div class="card" style="text-align:right;">
        <div class="muted">Scatter（✦）</div>
        <div class="mono">有連線：總傷害 × (1 + 0.5×n)<br />無連線：每枚 +5</div>
      </div>
    </div>

    <div class="slot">
      <div id="grid" class="grid"></div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div class="muted">本局明細</div>
      <div id="detail" class="mono" style="margin-top:6px; word-break: break-word;">—</div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div class="muted" style="margin-bottom:6px;">符號對照</div>
      <div class="legend">
        <span class="chip chip-blue">水</span>
        <span class="chip chip-red">火</span>
        <span class="chip chip-green">木</span>
        <span class="chip chip-yellow">光</span>
        <span class="chip chip-purple">暗</span>
        <span class="chip chip-indigo">★ Wild</span>
        <span class="chip chip-amber">✦ Scatter</span>
      </div>
    </div>
    <!-- 戰鬥／押注 UI -->
    <div class="card" style="margin-top:12px; display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
      <div>
        <div class="muted">錢包（Balance）</div>
        <div id="balance" class="mono" style="font-size:20px; font-weight:800;">0</div>
      </div>
      <div>
        <div class="muted">怪物屬性</div>
        <div id="monsterAttr" class="mono" style="font-size:20px; font-weight:800;">火</div>
      </div>
    </div>

    <div class="card" style="margin-top:12px; display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
      <div>
        <div class="muted">玩家 HP</div>
        <div class="mono"><span id="pHp">100</span> / <span id="pHpMax">100</span></div>
      </div>
      <div style="text-align:right;">
        <div class="muted">怪物 HP</div>
        <div class="mono"><span id="mHp">120</span> / <span id="mHpMax">120</span></div>
      </div>
    </div>

    <div class="muted" style="margin-top:18px;">v2 2025/12/01</div>
  </div>

      <!-- 規則對話框 -->
      <div id="rulesOverlay" class="rules-overlay">
        <div class="rules-dialog">
          <h2>遊戲規則說明</h2>
          <p>本遊戲為 5×3 格 RPG 主題拉霸機，怪物屬性隨機輪替，玩家以 HP 代表現實貨幣。</p>
      
          <ul>
            <li>每局由莊家收取現金並換成 HP，目前設定為：新台幣 100 元 → 100 HP。</li>
            <li>每次付費 SPIN 消耗固定 5 HP；FREE SPIN 不消耗 HP。</li>
            <li>玩家 HP 歸零時，本局立即結束，無法再 SPIN，請洽莊家是否加值開新局。</li>
            <li>怪物 HP 目前為 100，受到傷害累積至 100 以上時視為擊殺。</li>
            <li>每次擊殺怪物可獲得固定獎勵，目前為 30 金幣，累積於錢包（Balance）。</li>
            <li>當超額傷害（Overkill）達到怪物 HP 的 1 倍或 2 倍時，會額外獲得 FREE SPIN（依實作規則）。</li>
            <li>符號屬性（水、火、木、光、暗）依克制關係給予 1.5 倍傷害加成；Wild（★）可替任何屬性，Scatter（✦）依規則提供額外傷害。</li>
            <li>局末由莊家依錢包金幣數量換回現金（目前直觀設定為 1 金幣 ≈ 1 元，可視實際活動再調整）。</li>
          </ul>
      
          <button id="rulesCloseBtn" class="rules-close-btn">關閉</button>
        </div>
      </div>

  <!-- 掛載遊戲腳本（請與 index.html 同資料夾） -->
  <script src="slot.js"></script>
  <script src="combat.js"></script>
  <!-- 規則對話框控制 -->
  <script>
    (function () {
      const btn = document.getElementById('rulesBtn');
      const overlay = document.getElementById('rulesOverlay');
      const closeBtn = document.getElementById('rulesCloseBtn');

      if (!btn || !overlay || !closeBtn) return;

      btn.addEventListener('click', () => {
        overlay.classList.add('show');
      });

      closeBtn.addEventListener('click', () => {
        overlay.classList.remove('show');
      });

      // 點擊遮罩空白處也關閉
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('show');
        }
      });
    })();
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .catch(err => console.error('SW registration failed:', err));
    }
  </script>

</body>

</html>